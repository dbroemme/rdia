<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Wads::GraphWidget - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/navigation.js" defer></script>
<script src="../js/search.js" defer></script>
<script src="../js/search_index.js" defer></script>
<script src="../js/searcher.js" defer></script>
<script src="../js/darkfish.js" defer></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
<div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  <p class="link"><a href="Widget.html">Wads::Widget</a>
</div>

    
    
    
<!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    <li ><a href="#method-i-get_node_color">#get_node_color</a>
    <li ><a href="#method-i-handle_mouse_down">#handle_mouse_down</a>
    <li ><a href="#method-i-handle_mouse_up">#handle_mouse_up</a>
    <li ><a href="#method-i-handle_update">#handle_update</a>
    <li ><a href="#method-i-move_text_for_node">#move_text_for_node</a>
    <li ><a href="#method-i-overlaps_with_a_node">#overlaps_with_a_node</a>
    <li ><a href="#method-i-populate_rendered_nodes">#populate_rendered_nodes</a>
    <li ><a href="#method-i-prevent_text_overlap">#prevent_text_overlap</a>
    <li ><a href="#method-i-render">#render</a>
    <li ><a href="#method-i-scale_node_size">#scale_node_size</a>
    <li ><a href="#method-i-set_all_nodes_for_display">#set_all_nodes_for_display</a>
    <li ><a href="#method-i-set_center_node">#set_center_node</a>
    <li ><a href="#method-i-set_explorer_display">#set_explorer_display</a>
    <li ><a href="#method-i-set_tree_display">#set_tree_display</a>
    <li ><a href="#method-i-set_tree_recursive">#set_tree_recursive</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Wads::GraphWidget">
  <h1 id="class-Wads::GraphWidget" class="class">
    class Wads::GraphWidget
  </h1>

  <section class="description">
    
<p>Given a single node or a graph data structure, this widget displays a visualization of the graph using one of the available node widget classes. There are different display modes that control what nodes within the graph  are shown. The default display mode, GRAPH_DISPLAY_ALL, shows all nodes as the name implies. GRAPH_DISPLAY_TREE assumes an acyclic graph and renders the graph in a tree-like structure. GRAPH_DISPLAY_EXPLORER has a chosen center focus node with connected nodes circled around it based on the depth or distance from that node. This mode also allows the user to click on different nodes to navigate the graph and change focus nodes.</p>

  </section>

  <section id="5Buntitled-5D" class="documentation-section">



    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      <div id="attribute-i-graph" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">graph</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-is_explorer" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">is_explorer</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-selected_node" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">selected_node</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-selected_node_x_offset" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">selected_node_x_offset</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-selected_node_y_offset" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">selected_node_y_offset</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-size_by_connections" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">size_by_connections</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
    </section>


     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-new" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(x, y, width, height, graph, display_mode = GRAPH_DISPLAY_ALL)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Widget.html#method-c-new"><code>Wads::Widget::new</code></a>
            </div>

          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/wads/widgets.rb, line 2958</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span>, <span class="ruby-identifier">width</span>, <span class="ruby-identifier">height</span>, <span class="ruby-identifier">graph</span>, <span class="ruby-identifier">display_mode</span> = <span class="ruby-constant">GRAPH_DISPLAY_ALL</span>) 
    <span class="ruby-keyword">super</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span>)
    <span class="ruby-identifier">set_dimensions</span>(<span class="ruby-identifier">width</span>, <span class="ruby-identifier">height</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">graph</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Node</span> 
        <span class="ruby-ivar">@graph</span> = <span class="ruby-constant">Graph</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">graph</span>)
    <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@graph</span> = <span class="ruby-identifier">graph</span> 
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@size_by_connections</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-ivar">@is_explorer</span> = <span class="ruby-keyword">false</span> 
    <span class="ruby-keyword">if</span> [<span class="ruby-constant">GRAPH_DISPLAY_ALL</span>, <span class="ruby-constant">GRAPH_DISPLAY_TREE</span>, <span class="ruby-constant">GRAPH_DISPLAY_EXPLORER</span>].<span class="ruby-identifier">include?</span> <span class="ruby-identifier">display_mode</span> 
        <span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Displaying graph in #{display_mode} mode&quot;</span>)
    <span class="ruby-keyword">else</span> 
        <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;#{display_mode} is not a valid display mode for Graph Widget&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">display_mode</span> <span class="ruby-operator">==</span> <span class="ruby-constant">GRAPH_DISPLAY_ALL</span>
        <span class="ruby-identifier">set_all_nodes_for_display</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">display_mode</span> <span class="ruby-operator">==</span> <span class="ruby-constant">GRAPH_DISPLAY_TREE</span> 
        <span class="ruby-identifier">set_tree_display</span>
    <span class="ruby-keyword">else</span> 
        <span class="ruby-identifier">set_explorer_display</span> 
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

      <div id="method-i-get_node_color" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">get_node_color</span><span
            class="method-args">(node)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="get_node_color-source">
            <pre><span class="ruby-comment"># File lib/wads/widgets.rb, line 3209</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">get_node_color</span>(<span class="ruby-identifier">node</span>)
    <span class="ruby-identifier">color_tag</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">get_tag</span>(<span class="ruby-constant">COLOR_TAG</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">color_tag</span>.<span class="ruby-identifier">nil?</span> 
        <span class="ruby-keyword">return</span> <span class="ruby-ivar">@color</span> 
    <span class="ruby-keyword">end</span> 
    <span class="ruby-identifier">color_tag</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-handle_mouse_down" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">handle_mouse_down</span><span
            class="method-args">(mouse_x, mouse_y)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="handle_mouse_down-source">
            <pre><span class="ruby-comment"># File lib/wads/widgets.rb, line 2989</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">handle_mouse_down</span> <span class="ruby-identifier">mouse_x</span>, <span class="ruby-identifier">mouse_y</span>
    <span class="ruby-comment"># check to see if any node was selected</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@rendered_nodes</span>
        <span class="ruby-ivar">@rendered_nodes</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rn</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">rn</span>.<span class="ruby-identifier">contains_click</span>(<span class="ruby-identifier">mouse_x</span>, <span class="ruby-identifier">mouse_y</span>)
                <span class="ruby-ivar">@selected_node</span> = <span class="ruby-identifier">rn</span> 
                <span class="ruby-ivar">@selected_node_x_offset</span> = <span class="ruby-identifier">mouse_x</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">rn</span>.<span class="ruby-identifier">x</span> 
                <span class="ruby-ivar">@selected_node_y_offset</span> = <span class="ruby-identifier">mouse_y</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">rn</span>.<span class="ruby-identifier">y</span>
                <span class="ruby-ivar">@click_timestamp</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
            <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-constant">WidgetResult</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">false</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-handle_mouse_up" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">handle_mouse_up</span><span
            class="method-args">(mouse_x, mouse_y)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="handle_mouse_up-source">
            <pre><span class="ruby-comment"># File lib/wads/widgets.rb, line 3004</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">handle_mouse_up</span> <span class="ruby-identifier">mouse_x</span>, <span class="ruby-identifier">mouse_y</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@selected_node</span> 
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@is_explorer</span>
            <span class="ruby-identifier">time_between_mouse_up_down</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@click_timestamp</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">time_between_mouse_up_down</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0.2</span>
                <span class="ruby-comment"># Treat this as a single click and make the selected</span>
                <span class="ruby-comment"># node the new center node of the graph</span>
                <span class="ruby-identifier">set_explorer_display</span>(<span class="ruby-ivar">@selected_node</span>.<span class="ruby-identifier">data_node</span>)
            <span class="ruby-keyword">end</span> 
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@selected_node</span> = <span class="ruby-keyword">nil</span> 
    <span class="ruby-keyword">end</span> 
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-handle_update" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">handle_update</span><span
            class="method-args">(update_count, mouse_x, mouse_y)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="handle_update-source">
            <pre><span class="ruby-comment"># File lib/wads/widgets.rb, line 2982</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">handle_update</span> <span class="ruby-identifier">update_count</span>, <span class="ruby-identifier">mouse_x</span>, <span class="ruby-identifier">mouse_y</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">contains_click</span>(<span class="ruby-identifier">mouse_x</span>, <span class="ruby-identifier">mouse_y</span>) <span class="ruby-keyword">and</span> <span class="ruby-ivar">@selected_node</span> 
        <span class="ruby-ivar">@selected_node</span>.<span class="ruby-identifier">move_recursive_absolute</span>(<span class="ruby-identifier">mouse_x</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@selected_node_x_offset</span>,
                                               <span class="ruby-identifier">mouse_y</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@selected_node_y_offset</span>)
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-move_text_for_node" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">move_text_for_node</span><span
            class="method-args">(rendered_node)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="move_text_for_node-source">
            <pre><span class="ruby-comment"># File lib/wads/widgets.rb, line 3110</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">move_text_for_node</span>(<span class="ruby-identifier">rendered_node</span>)
    <span class="ruby-identifier">text</span> = <span class="ruby-identifier">rendered_node</span>.<span class="ruby-identifier">get_text_widget</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">nil?</span> 
        <span class="ruby-keyword">return</span> 
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">radians_between_attempts</span> = <span class="ruby-constant">DEG_360</span> <span class="ruby-operator">/</span> <span class="ruby-value">24</span>
    <span class="ruby-identifier">current_radians</span> = <span class="ruby-value">0.05</span>
    <span class="ruby-identifier">done</span> = <span class="ruby-keyword">false</span> 
    <span class="ruby-keyword">while</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">done</span>
        <span class="ruby-comment"># Use radians to spread the other nodes around the center node</span>
        <span class="ruby-comment"># TODO base the distance off of scale</span>
        <span class="ruby-identifier">text_x</span> = <span class="ruby-identifier">rendered_node</span>.<span class="ruby-identifier">center_x</span> <span class="ruby-operator">+</span> ((<span class="ruby-identifier">rendered_node</span>.<span class="ruby-identifier">width</span> <span class="ruby-operator">/</span> <span class="ruby-value">2</span>) <span class="ruby-operator">*</span> <span class="ruby-constant">Math</span>.<span class="ruby-identifier">cos</span>(<span class="ruby-identifier">current_radians</span>))
        <span class="ruby-identifier">text_y</span> = <span class="ruby-identifier">rendered_node</span>.<span class="ruby-identifier">center_y</span> <span class="ruby-operator">-</span> ((<span class="ruby-identifier">rendered_node</span>.<span class="ruby-identifier">height</span> <span class="ruby-operator">/</span> <span class="ruby-value">2</span>) <span class="ruby-operator">*</span> <span class="ruby-constant">Math</span>.<span class="ruby-identifier">sin</span>(<span class="ruby-identifier">current_radians</span>))
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">text_x</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@x</span> 
            <span class="ruby-identifier">text_x</span> = <span class="ruby-ivar">@x</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
        <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">text_x</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">right_edge</span> <span class="ruby-operator">-</span> <span class="ruby-value">20</span>
            <span class="ruby-identifier">text_x</span> = <span class="ruby-identifier">right_edge</span> <span class="ruby-operator">-</span> <span class="ruby-value">20</span>
        <span class="ruby-keyword">end</span> 
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">text_y</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@y</span> 
            <span class="ruby-identifier">text_y</span> = <span class="ruby-ivar">@y</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
        <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">text_y</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bottom_edge</span> <span class="ruby-operator">-</span> <span class="ruby-value">26</span> 
            <span class="ruby-identifier">text_y</span> = <span class="ruby-identifier">bottom_edge</span> <span class="ruby-operator">-</span> <span class="ruby-value">26</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">text</span>.<span class="ruby-identifier">x</span> = <span class="ruby-identifier">text_x</span> 
        <span class="ruby-identifier">text</span>.<span class="ruby-identifier">y</span> = <span class="ruby-identifier">text_y</span>
        <span class="ruby-identifier">current_radians</span> = <span class="ruby-identifier">current_radians</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">radians_between_attempts</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">overlaps_with_a_node</span>(<span class="ruby-identifier">text</span>)
            <span class="ruby-comment"># check for done</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_radians</span> <span class="ruby-operator">&gt;</span> <span class="ruby-constant">DEG_360</span>
                <span class="ruby-identifier">done</span> = <span class="ruby-keyword">true</span> 
                <span class="ruby-identifier">error</span>(<span class="ruby-string">&quot;ERROR: could not find a spot to put the text&quot;</span>)
            <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span> 
            <span class="ruby-identifier">done</span> = <span class="ruby-keyword">true</span>
        <span class="ruby-keyword">end</span> 
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-overlaps_with_a_node" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">overlaps_with_a_node</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="overlaps_with_a_node-source">
            <pre><span class="ruby-comment"># File lib/wads/widgets.rb, line 3148</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">overlaps_with_a_node</span>(<span class="ruby-identifier">text</span>)
    <span class="ruby-ivar">@rendered_nodes</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rn</span><span class="ruby-operator">|</span> 
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">label</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">rn</span>.<span class="ruby-identifier">label</span> 
            <span class="ruby-comment"># don&#39;t compare to yourself</span>
        <span class="ruby-keyword">else</span> 
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">rn</span>.<span class="ruby-identifier">overlaps_with</span>(<span class="ruby-identifier">text</span>) 
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
            <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-populate_rendered_nodes" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">populate_rendered_nodes</span><span
            class="method-args">(center_node = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="populate_rendered_nodes-source">
            <pre><span class="ruby-comment"># File lib/wads/widgets.rb, line 3241</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">populate_rendered_nodes</span>(<span class="ruby-identifier">center_node</span> = <span class="ruby-keyword">nil</span>)
    <span class="ruby-comment"># Spread out the other nodes around the center node</span>
    <span class="ruby-comment"># going in a circle at each depth level</span>
    <span class="ruby-identifier">stats</span> = <span class="ruby-constant">Stats</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;NodesPerDepth&quot;</span>)
    <span class="ruby-ivar">@visible_data_nodes</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">stats</span>.<span class="ruby-identifier">increment</span>(<span class="ruby-identifier">n</span>.<span class="ruby-identifier">depth</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">current_radians</span> = []
    <span class="ruby-identifier">radians_increment</span> = []
    (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">4</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">number_of_nodes_at_depth</span> = <span class="ruby-identifier">stats</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">n</span>)
        <span class="ruby-identifier">radians_increment</span>[<span class="ruby-identifier">n</span>] = <span class="ruby-constant">DEG_360</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">number_of_nodes_at_depth</span>.<span class="ruby-identifier">to_f</span>
        <span class="ruby-identifier">current_radians</span>[<span class="ruby-identifier">n</span>] = <span class="ruby-value">0.05</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">padding</span> = <span class="ruby-value">100</span>
    <span class="ruby-identifier">size_of_x_band</span> = (<span class="ruby-ivar">@width</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">padding</span>) <span class="ruby-operator">/</span> <span class="ruby-value">6</span>
    <span class="ruby-identifier">size_of_y_band</span> = (<span class="ruby-ivar">@height</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">padding</span>) <span class="ruby-operator">/</span> <span class="ruby-value">6</span>
    <span class="ruby-identifier">random_x</span> = <span class="ruby-identifier">size_of_x_band</span> <span class="ruby-operator">/</span> <span class="ruby-value">8</span>
    <span class="ruby-identifier">random_y</span> = <span class="ruby-identifier">size_of_y_band</span> <span class="ruby-operator">/</span> <span class="ruby-value">8</span>
    <span class="ruby-identifier">half_random_x</span> = <span class="ruby-identifier">random_x</span> <span class="ruby-operator">/</span> <span class="ruby-value">2</span>
    <span class="ruby-identifier">half_random_y</span> = <span class="ruby-identifier">random_y</span> <span class="ruby-operator">/</span> <span class="ruby-value">2</span>

    <span class="ruby-comment"># Precompute the band center points</span>
    <span class="ruby-comment"># then reference by the scale or depth values below</span>
    <span class="ruby-identifier">band_center_x</span> = <span class="ruby-identifier">padding</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">size_of_x_band</span> <span class="ruby-operator">/</span> <span class="ruby-value">2</span>) 
    <span class="ruby-identifier">band_center_y</span> = <span class="ruby-identifier">padding</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">size_of_y_band</span> <span class="ruby-operator">/</span> <span class="ruby-value">2</span>) 
    <span class="ruby-comment"># depth 1 [0] - center node, distance should be zero. Should be only one</span>
    <span class="ruby-comment"># depth 2 [1] - band one</span>
    <span class="ruby-comment"># depth 3 [2] - band two</span>
    <span class="ruby-comment"># depth 4 [3] - band three</span>
    <span class="ruby-identifier">bands_x</span> = [<span class="ruby-value">0</span>, <span class="ruby-identifier">band_center_x</span>]
    <span class="ruby-identifier">bands_x</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">band_center_x</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">size_of_x_band</span>
    <span class="ruby-identifier">bands_x</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">band_center_x</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">size_of_x_band</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">size_of_x_band</span>

    <span class="ruby-identifier">bands_y</span> = [<span class="ruby-value">0</span>, <span class="ruby-identifier">band_center_y</span>]
    <span class="ruby-identifier">bands_y</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">band_center_y</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">size_of_y_band</span>
    <span class="ruby-identifier">bands_y</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">band_center_y</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">size_of_y_band</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">size_of_y_band</span>

    <span class="ruby-ivar">@visible_data_nodes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">node_name</span>, <span class="ruby-identifier">data_node</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">process_this_node</span> = <span class="ruby-keyword">true</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">center_node</span> 
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">node_name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">center_node</span>.<span class="ruby-identifier">name</span> 
                <span class="ruby-identifier">process_this_node</span> = <span class="ruby-keyword">false</span> 
            <span class="ruby-keyword">end</span> 
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">process_this_node</span> 
            <span class="ruby-identifier">scale_to_use</span> = <span class="ruby-value">1</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">stats</span>.<span class="ruby-identifier">count</span>(<span class="ruby-value">1</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">stats</span>.<span class="ruby-identifier">count</span>(<span class="ruby-value">2</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
                <span class="ruby-comment"># if all nodes are depth 1, then size everything</span>
                <span class="ruby-comment"># as a small node</span>
            <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">data_node</span>.<span class="ruby-identifier">depth</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">4</span>
                <span class="ruby-identifier">scale_to_use</span> = <span class="ruby-value">5</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">data_node</span>.<span class="ruby-identifier">depth</span>
            <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@is_explorer</span> 
                <span class="ruby-comment"># TODO Layer the nodes around the center</span>
                <span class="ruby-comment"># We need a better multiplier based on the height and width</span>
                <span class="ruby-comment"># max distance x would be (@width / 2) - padding</span>
                <span class="ruby-comment"># divide that into three regions, layer 2, 3, and 4</span>
                <span class="ruby-comment"># get the center point for each of these regions, and do a random from there</span>
                <span class="ruby-comment"># scale to use determines which of the regions</span>
                <span class="ruby-identifier">band_index</span> = <span class="ruby-value">4</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">scale_to_use</span>
                <span class="ruby-identifier">distance_from_center_x</span> = <span class="ruby-identifier">bands_x</span>[<span class="ruby-identifier">band_index</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">rand</span>(<span class="ruby-identifier">random_x</span>) <span class="ruby-operator">-</span> <span class="ruby-identifier">half_random_x</span>
                <span class="ruby-identifier">distance_from_center_y</span> = <span class="ruby-identifier">bands_y</span>[<span class="ruby-identifier">band_index</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">rand</span>(<span class="ruby-identifier">random_y</span>) <span class="ruby-operator">-</span> <span class="ruby-identifier">half_random_y</span>
            <span class="ruby-keyword">else</span> 
                <span class="ruby-identifier">distance_from_center_x</span> = <span class="ruby-value">80</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rand</span>(<span class="ruby-value">200</span>)
                <span class="ruby-identifier">distance_from_center_y</span> = <span class="ruby-value">40</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rand</span>(<span class="ruby-value">100</span>)
            <span class="ruby-keyword">end</span>
            <span class="ruby-comment"># Use radians to spread the other nodes around the center node</span>
            <span class="ruby-identifier">radians_to_use</span> = <span class="ruby-identifier">current_radians</span>[<span class="ruby-identifier">data_node</span>.<span class="ruby-identifier">depth</span>]
            <span class="ruby-identifier">radians_to_use</span> = <span class="ruby-identifier">radians_to_use</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">rand</span>(<span class="ruby-identifier">radians_increment</span>[<span class="ruby-identifier">data_node</span>.<span class="ruby-identifier">depth</span>]) <span class="ruby-operator">/</span> <span class="ruby-value">2</span>)
            <span class="ruby-identifier">current_radians</span>[<span class="ruby-identifier">data_node</span>.<span class="ruby-identifier">depth</span>] = <span class="ruby-identifier">current_radians</span>[<span class="ruby-identifier">data_node</span>.<span class="ruby-identifier">depth</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">radians_increment</span>[<span class="ruby-identifier">data_node</span>.<span class="ruby-identifier">depth</span>]
            <span class="ruby-identifier">node_x</span> = <span class="ruby-identifier">center_x</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">distance_from_center_x</span> <span class="ruby-operator">*</span> <span class="ruby-constant">Math</span>.<span class="ruby-identifier">cos</span>(<span class="ruby-identifier">radians_to_use</span>))
            <span class="ruby-identifier">node_y</span> = <span class="ruby-identifier">center_y</span> <span class="ruby-operator">-</span> (<span class="ruby-identifier">distance_from_center_y</span> <span class="ruby-operator">*</span> <span class="ruby-constant">Math</span>.<span class="ruby-identifier">sin</span>(<span class="ruby-identifier">radians_to_use</span>))
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">node_x</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@x</span> 
                <span class="ruby-identifier">node_x</span> = <span class="ruby-ivar">@x</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
            <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">node_x</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">right_edge</span> <span class="ruby-operator">-</span> <span class="ruby-value">20</span>
                <span class="ruby-identifier">node_x</span> = <span class="ruby-identifier">right_edge</span> <span class="ruby-operator">-</span> <span class="ruby-value">20</span>
            <span class="ruby-keyword">end</span> 
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">node_y</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@y</span> 
                <span class="ruby-identifier">node_y</span> = <span class="ruby-ivar">@y</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
            <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">node_y</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bottom_edge</span> <span class="ruby-operator">-</span> <span class="ruby-value">26</span> 
                <span class="ruby-identifier">node_y</span> = <span class="ruby-identifier">bottom_edge</span> <span class="ruby-operator">-</span> <span class="ruby-value">26</span>
            <span class="ruby-keyword">end</span>

            <span class="ruby-comment"># Note we can link between data nodes and rendered nodes using the node name</span>
            <span class="ruby-comment"># We have a map of each</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gui_theme</span>.<span class="ruby-identifier">use_icons</span>
                <span class="ruby-ivar">@rendered_nodes</span>[<span class="ruby-identifier">data_node</span>.<span class="ruby-identifier">name</span>] = <span class="ruby-constant">NodeIconWidget</span>.<span class="ruby-identifier">new</span>(
                                                <span class="ruby-identifier">node_x</span>,
                                                <span class="ruby-identifier">node_y</span>,
                                                <span class="ruby-identifier">data_node</span>,
                                                <span class="ruby-identifier">get_node_color</span>(<span class="ruby-identifier">data_node</span>),
                                                <span class="ruby-identifier">scale_to_use</span>,
                                                <span class="ruby-ivar">@is_explorer</span>) 
            <span class="ruby-keyword">else</span>
                <span class="ruby-ivar">@rendered_nodes</span>[<span class="ruby-identifier">data_node</span>.<span class="ruby-identifier">name</span>] = <span class="ruby-constant">NodeWidget</span>.<span class="ruby-identifier">new</span>(
                                                <span class="ruby-identifier">node_x</span>,
                                                <span class="ruby-identifier">node_y</span>,
                                                <span class="ruby-identifier">data_node</span>,
                                                <span class="ruby-identifier">get_node_color</span>(<span class="ruby-identifier">data_node</span>),
                                                <span class="ruby-identifier">scale_to_use</span>,
                                                <span class="ruby-ivar">@is_explorer</span>)
            <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@rendered_nodes</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rn</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">rn</span>.<span class="ruby-identifier">base_z</span> = <span class="ruby-ivar">@base_z</span>
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-prevent_text_overlap" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">prevent_text_overlap</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="prevent_text_overlap-source">
            <pre><span class="ruby-comment"># File lib/wads/widgets.rb, line 3087</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">prevent_text_overlap</span> 
    <span class="ruby-ivar">@rendered_nodes</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rn</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">text</span> = <span class="ruby-identifier">rn</span>.<span class="ruby-identifier">get_text_widget</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">text</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">overlaps_with_a_node</span>(<span class="ruby-identifier">text</span>)
                <span class="ruby-identifier">move_text_for_node</span>(<span class="ruby-identifier">rn</span>)
            <span class="ruby-keyword">else</span> 
                <span class="ruby-identifier">move_in_bounds</span> = <span class="ruby-keyword">false</span>
                <span class="ruby-comment"># We also check to see if the text is outside the edges of this widget</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">x</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@x</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">right_edge</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">right_edge</span> 
                    <span class="ruby-identifier">move_in_bounds</span> = <span class="ruby-keyword">true</span> 
                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">y</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@y</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">bottom_edge</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bottom_edge</span> 
                    <span class="ruby-identifier">move_in_bounds</span> = <span class="ruby-keyword">true</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">move_in_bounds</span> 
                    <span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;#{text.label} was out of bounds&quot;</span>)
                    <span class="ruby-identifier">move_text_for_node</span>(<span class="ruby-identifier">rn</span>)
                <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-render" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">render</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="render-source">
            <pre><span class="ruby-comment"># File lib/wads/widgets.rb, line 3352</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">render</span> 
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@rendered_nodes</span>
        <span class="ruby-ivar">@rendered_nodes</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">vn</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">vn</span>.<span class="ruby-identifier">draw</span> 
        <span class="ruby-keyword">end</span> 

        <span class="ruby-comment"># Draw the connections between nodes</span>
        <span class="ruby-ivar">@visible_data_nodes</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">data_node</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">data_node</span>.<span class="ruby-identifier">outputs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">connected_data_node</span><span class="ruby-operator">|</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">connected_data_node</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Edge</span> 
                    <span class="ruby-identifier">connected_data_node</span> = <span class="ruby-identifier">connected_data_node</span>.<span class="ruby-identifier">destination</span> 
                <span class="ruby-keyword">end</span>
                <span class="ruby-identifier">rendered_node</span> = <span class="ruby-ivar">@rendered_nodes</span>[<span class="ruby-identifier">data_node</span>.<span class="ruby-identifier">name</span>]
                <span class="ruby-identifier">connected_rendered_node</span> = <span class="ruby-ivar">@rendered_nodes</span>[<span class="ruby-identifier">connected_data_node</span>.<span class="ruby-identifier">name</span>]
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">connected_rendered_node</span>.<span class="ruby-identifier">nil?</span>
                    <span class="ruby-comment"># Don&#39;t draw if it is not currently visible</span>
                <span class="ruby-keyword">else</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@is_explorer</span> <span class="ruby-keyword">and</span> (<span class="ruby-identifier">rendered_node</span>.<span class="ruby-identifier">is_background</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">connected_rendered_node</span>.<span class="ruby-identifier">is_background</span>)
                        <span class="ruby-comment"># Use a dull gray color for the line</span>
                        <span class="ruby-constant">Gosu</span><span class="ruby-operator">::</span><span class="ruby-identifier">draw_line</span> <span class="ruby-identifier">rendered_node</span>.<span class="ruby-identifier">center_x</span>, <span class="ruby-identifier">rendered_node</span>.<span class="ruby-identifier">center_y</span>, <span class="ruby-constant">COLOR_LIGHT_GRAY</span>,
                            <span class="ruby-identifier">connected_rendered_node</span>.<span class="ruby-identifier">center_x</span>, <span class="ruby-identifier">connected_rendered_node</span>.<span class="ruby-identifier">center_y</span>, <span class="ruby-constant">COLOR_LIGHT_GRAY</span>,
                            <span class="ruby-identifier">relative_z_order</span>(<span class="ruby-constant">Z_ORDER_GRAPHIC_ELEMENTS</span>)
                    <span class="ruby-keyword">else</span>
                        <span class="ruby-constant">Gosu</span><span class="ruby-operator">::</span><span class="ruby-identifier">draw_line</span> <span class="ruby-identifier">rendered_node</span>.<span class="ruby-identifier">center_x</span>, <span class="ruby-identifier">rendered_node</span>.<span class="ruby-identifier">center_y</span>, <span class="ruby-identifier">rendered_node</span>.<span class="ruby-identifier">graphics_color</span>,
                            <span class="ruby-identifier">connected_rendered_node</span>.<span class="ruby-identifier">center_x</span>, <span class="ruby-identifier">connected_rendered_node</span>.<span class="ruby-identifier">center_y</span>, <span class="ruby-identifier">connected_rendered_node</span>.<span class="ruby-identifier">graphics_color</span>,
                            <span class="ruby-identifier">relative_z_order</span>(<span class="ruby-constant">Z_ORDER_GRAPHIC_ELEMENTS</span>)
                    <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span> 
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-scale_node_size" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">scale_node_size</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="scale_node_size-source">
            <pre><span class="ruby-comment"># File lib/wads/widgets.rb, line 3067</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">scale_node_size</span> 
    <span class="ruby-identifier">range</span> = <span class="ruby-ivar">@graph</span>.<span class="ruby-identifier">get_number_of_connections_range</span>
    <span class="ruby-comment"># There are six colors. Any number of scale sizes</span>
    <span class="ruby-comment"># Lets try 4 first as a max size.</span>
    <span class="ruby-identifier">bins</span> = <span class="ruby-identifier">range</span>.<span class="ruby-identifier">bin_max_values</span>(<span class="ruby-value">4</span>)  

    <span class="ruby-comment"># Set the scale for each node</span>
    <span class="ruby-ivar">@visible_data_nodes</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">node</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">num_links</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">number_of_links</span>
        <span class="ruby-identifier">index</span> = <span class="ruby-value">0</span>
        <span class="ruby-keyword">while</span> <span class="ruby-identifier">index</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">bins</span>.<span class="ruby-identifier">size</span> 
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">num_links</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">bins</span>[<span class="ruby-identifier">index</span>]
                <span class="ruby-ivar">@rendered_nodes</span>[<span class="ruby-identifier">node</span>.<span class="ruby-identifier">name</span>].<span class="ruby-identifier">set_scale</span>(<span class="ruby-identifier">index</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-ivar">@is_explorer</span>)
                <span class="ruby-identifier">index</span> = <span class="ruby-identifier">bins</span>.<span class="ruby-identifier">size</span>
            <span class="ruby-keyword">end</span> 
            <span class="ruby-identifier">index</span> = <span class="ruby-identifier">index</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
        <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-set_all_nodes_for_display" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">set_all_nodes_for_display</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="set_all_nodes_for_display-source">
            <pre><span class="ruby-comment"># File lib/wads/widgets.rb, line 3199</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set_all_nodes_for_display</span> 
    <span class="ruby-ivar">@visible_data_nodes</span> = <span class="ruby-ivar">@graph</span>.<span class="ruby-identifier">node_map</span>
    <span class="ruby-ivar">@rendered_nodes</span> = {}
    <span class="ruby-identifier">populate_rendered_nodes</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@size_by_connections</span>
        <span class="ruby-identifier">scale_node_size</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">prevent_text_overlap</span> 
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-set_center_node" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">set_center_node</span><span
            class="method-args">(center_node, max_depth = -1)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="set_center_node-source">
            <pre><span class="ruby-comment"># File lib/wads/widgets.rb, line 3217</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set_center_node</span>(<span class="ruby-identifier">center_node</span>, <span class="ruby-identifier">max_depth</span> = <span class="ruby-value">-1</span>)
    <span class="ruby-comment"># Determine the list of nodes to draw</span>
    <span class="ruby-ivar">@graph</span>.<span class="ruby-identifier">reset_visited</span> 
    <span class="ruby-ivar">@visible_data_nodes</span> = <span class="ruby-ivar">@graph</span>.<span class="ruby-identifier">traverse_and_collect_nodes</span>(<span class="ruby-identifier">center_node</span>, <span class="ruby-identifier">max_depth</span>)

    <span class="ruby-comment"># Convert the data nodes to rendered nodes</span>
    <span class="ruby-comment"># Start by putting the center node in the center, then draw others around it</span>
    <span class="ruby-ivar">@rendered_nodes</span> = {}
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gui_theme</span>.<span class="ruby-identifier">use_icons</span>
        <span class="ruby-ivar">@rendered_nodes</span>[<span class="ruby-identifier">center_node</span>.<span class="ruby-identifier">name</span>] = <span class="ruby-constant">NodeIconWidget</span>.<span class="ruby-identifier">new</span>(
            <span class="ruby-identifier">center_x</span>, <span class="ruby-identifier">center_y</span>, <span class="ruby-identifier">center_node</span>, <span class="ruby-identifier">get_node_color</span>(<span class="ruby-identifier">center_node</span>)) 
    <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@rendered_nodes</span>[<span class="ruby-identifier">center_node</span>.<span class="ruby-identifier">name</span>] = <span class="ruby-constant">NodeWidget</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">center_x</span>, <span class="ruby-identifier">center_y</span>,
            <span class="ruby-identifier">center_node</span>, <span class="ruby-identifier">get_node_color</span>(<span class="ruby-identifier">center_node</span>), <span class="ruby-identifier">get_node_color</span>(<span class="ruby-identifier">center_node</span>))
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">populate_rendered_nodes</span>(<span class="ruby-identifier">center_node</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@size_by_connections</span>
        <span class="ruby-identifier">scale_node_size</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">prevent_text_overlap</span> 
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-set_explorer_display" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">set_explorer_display</span><span
            class="method-args">(center_node = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="set_explorer_display-source">
            <pre><span class="ruby-comment"># File lib/wads/widgets.rb, line 3018</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set_explorer_display</span>(<span class="ruby-identifier">center_node</span> = <span class="ruby-keyword">nil</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">center_node</span>.<span class="ruby-identifier">nil?</span> 
        <span class="ruby-comment"># If not specified, pick a center node as the one with the most connections</span>
        <span class="ruby-identifier">center_node</span> = <span class="ruby-ivar">@graph</span>.<span class="ruby-identifier">node_with_most_connections</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-ivar">@graph</span>.<span class="ruby-identifier">reset_visited</span>
    <span class="ruby-ivar">@visible_data_nodes</span> = {}
    <span class="ruby-identifier">center_node</span>.<span class="ruby-identifier">bfs</span>(<span class="ruby-value">4</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
        <span class="ruby-ivar">@visible_data_nodes</span>[<span class="ruby-identifier">n</span>.<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">n</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-ivar">@size_by_connections</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-ivar">@is_explorer</span> = <span class="ruby-keyword">true</span>

    <span class="ruby-ivar">@rendered_nodes</span> = {}
    <span class="ruby-identifier">populate_rendered_nodes</span>

    <span class="ruby-identifier">prevent_text_overlap</span> 
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-set_tree_display" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">set_tree_display</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="set_tree_display-source">
            <pre><span class="ruby-comment"># File lib/wads/widgets.rb, line 3039</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set_tree_display</span>
    <span class="ruby-ivar">@graph</span>.<span class="ruby-identifier">reset_visited</span>
    <span class="ruby-ivar">@visible_data_nodes</span> = <span class="ruby-ivar">@graph</span>.<span class="ruby-identifier">node_map</span>
    <span class="ruby-ivar">@rendered_nodes</span> = {}

    <span class="ruby-identifier">root_nodes</span> = <span class="ruby-ivar">@graph</span>.<span class="ruby-identifier">root_nodes</span>
    <span class="ruby-identifier">number_of_root_nodes</span> = <span class="ruby-identifier">root_nodes</span>.<span class="ruby-identifier">size</span> 
    <span class="ruby-identifier">width_for_each_root_tree</span> = <span class="ruby-ivar">@width</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">number_of_root_nodes</span>

    <span class="ruby-identifier">start_x</span> = <span class="ruby-value">0</span>
    <span class="ruby-identifier">y_level</span> = <span class="ruby-value">20</span>
    <span class="ruby-identifier">root_nodes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">root</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">set_tree_recursive</span>(<span class="ruby-identifier">root</span>, <span class="ruby-identifier">start_x</span>, <span class="ruby-identifier">start_x</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">width_for_each_root_tree</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">y_level</span>)
        <span class="ruby-identifier">start_x</span> = <span class="ruby-identifier">start_x</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">width_for_each_root_tree</span>
        <span class="ruby-identifier">y_level</span> = <span class="ruby-identifier">y_level</span> <span class="ruby-operator">+</span> <span class="ruby-value">40</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-ivar">@rendered_nodes</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rn</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">rn</span>.<span class="ruby-identifier">base_z</span> = <span class="ruby-ivar">@base_z</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@size_by_connections</span>
        <span class="ruby-identifier">scale_node_size</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">prevent_text_overlap</span> 
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-set_tree_recursive" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">set_tree_recursive</span><span
            class="method-args">(current_node, start_x, end_x, y_level)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="set_tree_recursive-source">
            <pre><span class="ruby-comment"># File lib/wads/widgets.rb, line 3161</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set_tree_recursive</span>(<span class="ruby-identifier">current_node</span>, <span class="ruby-identifier">start_x</span>, <span class="ruby-identifier">end_x</span>, <span class="ruby-identifier">y_level</span>)
    <span class="ruby-comment"># Draw the current node, and then recursively divide up</span>
    <span class="ruby-comment"># and call again for each of the children</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_node</span>.<span class="ruby-identifier">visited</span> 
        <span class="ruby-keyword">return</span> 
    <span class="ruby-keyword">end</span> 
    <span class="ruby-identifier">current_node</span>.<span class="ruby-identifier">visited</span> = <span class="ruby-keyword">true</span>

    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gui_theme</span>.<span class="ruby-identifier">use_icons</span>
        <span class="ruby-ivar">@rendered_nodes</span>[<span class="ruby-identifier">current_node</span>.<span class="ruby-identifier">name</span>] = <span class="ruby-constant">NodeIconWidget</span>.<span class="ruby-identifier">new</span>(
            <span class="ruby-identifier">x_pixel_to_screen</span>(<span class="ruby-identifier">start_x</span> <span class="ruby-operator">+</span> ((<span class="ruby-identifier">end_x</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">start_x</span>) <span class="ruby-operator">/</span> <span class="ruby-value">2</span>)),
            <span class="ruby-identifier">y_pixel_to_screen</span>(<span class="ruby-identifier">y_level</span>),
            <span class="ruby-identifier">current_node</span>,
            <span class="ruby-identifier">get_node_color</span>(<span class="ruby-identifier">current_node</span>))
    <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@rendered_nodes</span>[<span class="ruby-identifier">current_node</span>.<span class="ruby-identifier">name</span>] = <span class="ruby-constant">NodeWidget</span>.<span class="ruby-identifier">new</span>(
            <span class="ruby-identifier">x_pixel_to_screen</span>(<span class="ruby-identifier">start_x</span> <span class="ruby-operator">+</span> ((<span class="ruby-identifier">end_x</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">start_x</span>) <span class="ruby-operator">/</span> <span class="ruby-value">2</span>)),
            <span class="ruby-identifier">y_pixel_to_screen</span>(<span class="ruby-identifier">y_level</span>),
            <span class="ruby-identifier">current_node</span>,
            <span class="ruby-identifier">get_node_color</span>(<span class="ruby-identifier">current_node</span>))
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">number_of_child_nodes</span> = <span class="ruby-identifier">current_node</span>.<span class="ruby-identifier">outputs</span>.<span class="ruby-identifier">size</span> 
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">number_of_child_nodes</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
        <span class="ruby-keyword">return</span> 
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">width_for_each_child_tree</span> = (<span class="ruby-identifier">end_x</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">start_x</span>) <span class="ruby-operator">/</span> <span class="ruby-identifier">number_of_child_nodes</span>
    <span class="ruby-identifier">start_child_x</span> = <span class="ruby-identifier">start_x</span> <span class="ruby-operator">+</span> <span class="ruby-value">5</span>

    <span class="ruby-identifier">current_node</span>.<span class="ruby-identifier">outputs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span> 
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Edge</span> 
            <span class="ruby-identifier">child</span> = <span class="ruby-identifier">child</span>.<span class="ruby-identifier">destination</span> 
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">set_tree_recursive</span>(<span class="ruby-identifier">child</span>, <span class="ruby-identifier">start_child_x</span>, <span class="ruby-identifier">start_child_x</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">width_for_each_child_tree</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">y_level</span> <span class="ruby-operator">+</span> <span class="ruby-value">40</span>)
        <span class="ruby-identifier">start_child_x</span> = <span class="ruby-identifier">start_child_x</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">width_for_each_child_tree</span>
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.3.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

